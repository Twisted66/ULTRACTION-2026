---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import LogoLoop from '../../components/common/LogoLoop.astro';
import SectionBackground from '../../components/common/SectionBackground';

// Pre-render this page as static HTML at build time
export const prerender = true;

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map(project => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const slug = Astro.params.slug;
const projectFromProps = Astro.props.project;
const projectFromSlug = slug
  ? (await getCollection('projects')).find((entry) => entry.slug === slug)
  : undefined;
const project = projectFromProps ?? projectFromSlug;

if (!project) {
  return Astro.redirect('/projects');
}

const { Content } = await project.render();

const projectImages =
  project.data.images && project.data.images.length > 0
    ? project.data.images
    : ['/logo/UGC-HEADER.png'];

const heroBentoImages = Array.from({ length: 6 }, (_, index) => projectImages[index % projectImages.length]);
const showBentoPager = projectImages.length > 6;

// Enhanced bento layout configuration
const bentoLayout = [
  { colSpan: 2, rowSpan: 2 }, // Large featured image
  { colSpan: 1, rowSpan: 1 }, // Small
  { colSpan: 1, rowSpan: 1 }, // Small
  { colSpan: 1, rowSpan: 1 }, // Small
  { colSpan: 1, rowSpan: 1 }, // Small
];

const projectTitle = project.data.title.trim().replace(/\s+/g, ' ');
const titleWords = projectTitle.split(' ').filter(Boolean);
let titleLine1 = projectTitle;
let titleLine2 = '';

if (titleWords.length > 1) {
  const totalChars = titleWords.reduce((sum, word) => sum + word.length, 0);
  const midpoint = Math.ceil(totalChars / 2);
  let count = 0;
  let splitAt = 1;

  for (let i = 0; i < titleWords.length - 1; i += 1) {
    count += titleWords[i].length;
    if (count >= midpoint) {
      splitAt = i + 1;
      break;
    }
  }

  // Keep "BYPASS PARALLEL ..." together on the same rendered line.
  const bypassIndex = titleWords.findIndex((word) => word.toUpperCase() === 'BYPASS');
  const parallelIndex = titleWords.findIndex((word) => word.toUpperCase() === 'PARALLEL');
  if (bypassIndex > 0 && parallelIndex === bypassIndex + 1) {
    splitAt = bypassIndex;
  }

  titleLine1 = titleWords.slice(0, splitAt).join(' ');
  titleLine2 = titleWords.slice(splitAt).join(' ');
}

// Project metadata for stats display
const projectStats = [
  {
    label: 'Location',
    value: project.data.location.split(',')[0],
    meta: project.data.location,
  },
  {
    label: 'Category',
    value: project.data.category.charAt(0).toUpperCase() + project.data.category.slice(1),
    icon: getCategoryIcon(project.data.category),
  },
  ...(project.data.client ? [{
    label: 'Client',
    value: project.data.client.length > 30 ? project.data.client.substring(0, 30) + '...' : project.data.client,
  }] : []),
  ...(project.data.duration ? [{
    label: 'Duration',
    value: project.data.duration,
  }] : []),
  ...(project.data.completed ? [{
    label: 'Completed',
    value: new Date(project.data.completed).toLocaleDateString('en-US', { year: 'numeric', month: 'short' }),
  }] : []),
  ...(project.data.status ? [{
    label: 'Status',
    value: project.data.status,
    emphasis: project.data.status === 'Completed' ? 'primary' : 'secondary',
  }] : []),
];

function getCategoryIcon(category: string): string {
  const icons: Record<string, string> = {
    infrastructure: 'infrastructure',
    residential: 'home',
    commercial: 'building',
    industrial: 'factory',
    marine: 'anchor',
    heritage: 'landmark',
    'oil-gas': 'fuel',
  };
  return icons[category] || 'project';
}

---

<Layout
  title={`${project.data.title} - ULTRACTION Projects`}
  description={`Case study: ${project.data.title} - ${project.data.category} project in ${project.data.location}.`}
  image={project.data.images?.[0] || '/logo/UGC-HEADER.png'}
>
  <!-- Enhanced Hero Section -->
  <section class="project-hero-section relative h-[90vh] min-h-[650px] overflow-hidden">
    <!-- Background image with parallax effect -->
    <div class="absolute inset-0">
      {project.data.images && project.data.images.length > 0 ? (
        <img
          src={projectImages[0]}
          alt={project.data.title}
          class="project-hero-bg w-full h-full object-cover"
        />
      ) : (
        <div class="w-full h-full bg-primary/10"></div>
      )}
      <!-- Enhanced gradient overlay with better depth -->
      <div class="absolute inset-0 project-hero-overlay"></div>
      <!-- Animated noise texture for visual interest -->
      <div class="absolute inset-0 opacity-[0.03] noise-texture"></div>
    </div>

    <!-- Hero content -->
    <div class="absolute inset-0 flex flex-col justify-end p-6 md:p-16 lg:p-32 pb-16 md:pb-24">
      <div class="project-hero-copy max-w-6xl animate-slide-up">
        <!-- Enhanced badges with better visual hierarchy -->
        <div class="flex items-center gap-3 sm:gap-4 mb-8 flex-wrap">
          <span class="project-hero-chip category-badge px-4 py-2 bg-accent text-white text-xs uppercase tracking-[0.2em] font-semibold flex items-center gap-2">
            <span class="w-1.5 h-1.5 bg-white/60 rounded-full animate-pulse"></span>
            {project.data.category}
          </span>
          {project.data.featured && (
            <span class="project-hero-chip featured-badge px-4 py-2 bg-white/10 backdrop-blur-sm border border-white/20 text-white text-xs uppercase tracking-[0.15em] font-medium flex items-center gap-2">
              <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
              Featured Project
            </span>
          )}
        </div>

        <!-- Enhanced title with better typography -->
        <h1 class="project-hero-title font-bold text-white mb-6 uppercase leading-[0.92] font-heading">
          <span class="block">{titleLine1}</span>
          {titleLine2 && <span class="block mt-1">{titleLine2}</span>}
        </h1>

        <!-- Enhanced location with better styling -->
        <p class="project-hero-location text-base md:text-lg text-white/80 font-light max-w-2xl flex items-center gap-3">
          <svg class="w-4 h-4 text-accent/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          {project.data.location}
        </p>

        <!-- Scroll indicator -->
        <div class="mt-12 animate-bounce">
          <div class="flex flex-col items-center gap-2 text-white/50">
            <span class="text-[10px] uppercase tracking-[0.2em]">Scroll to explore</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom gradient fade -->
    <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-background to-transparent"></div>
  </section>

  <!-- Enhanced Project Details Section -->
  <section class="project-details-section py-20 md:py-28 px-4 md:px-8 lg:px-16 border-b border-primary/10 dark:border-white/10">
    <div class="w-full max-w-[98vw] mx-auto">
      <!-- Enhanced bento layout with stats sidebar -->
      <div class="project-overview-bento-layout">
        <!-- Left Sidebar: Project Stats -->
        <aside class="project-stats-sidebar">
          <h2 class="project-overview-title">Project Details</h2>

          <!-- Enhanced stat cards -->
          <div class="project-stats-list">
            {projectStats.map((stat, index) => (
              <div
                class={`project-stat-card ${stat.emphasis === 'primary' ? 'stat-primary' : ''} ${stat.emphasis === 'secondary' ? 'stat-secondary' : ''}`}
                style={`animation-delay: ${index * 100}ms`}
              >
                <div class="stat-label">{stat.label}</div>
                <div class="stat-value">
                  {stat.value}
                  {stat.icon && (
                    <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      {stat.icon === 'infrastructure' && (
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                      )}
                      {stat.icon === 'home' && (
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                      )}
                      {stat.icon === 'building' && (
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                      )}
                      {!['infrastructure', 'home', 'building'].includes(stat.icon || '') && (
                        <circle cx="12" cy="12" r="3"/>
                      )}
                    </svg>
                  )}
                </div>
                {stat.meta && <div class="stat-meta">{stat.meta}</div>}
              </div>
            ))}
          </div>
        </aside>

        <!-- Main Content Area -->
        <div class="project-main-content">
          <!-- Enhanced Bento Gallery -->
          <div class="project-poster-shell" data-project-bento data-images={JSON.stringify(projectImages)}>
            <!-- Decorative frame -->
            <div class="project-poster-frame" aria-hidden="true">
              <div class="frame-corner frame-tl"></div>
              <div class="frame-corner frame-tr"></div>
              <div class="frame-corner frame-bl"></div>
              <div class="frame-corner frame-br"></div>
            </div>

            <!-- Enhanced controls -->
            {showBentoPager && (
              <div class="project-bento-controls">
                <button type="button" class="project-bento-control" data-bento-prev aria-label="Previous images">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                </button>
                <div class="bento-page-indicator">
                  <span class="current-page" data-current-page>1</span>
                  <span class="page-separator">/</span>
                  <span class="total-pages" data-total-pages>1</span>
                </div>
                <button type="button" class="project-bento-control" data-bento-next aria-label="Next images">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </button>
              </div>
            )}

            <!-- Enhanced bento grid -->
            <div class="project-hero-bento-grid">
              {heroBentoImages.map((image, index) => {
                const layout = bentoLayout[index % bentoLayout.length];
                return (
                  <figure
                    class={[
                      'project-bento-item',
                      `col-span-${layout.colSpan}`,
                      `row-span-${layout.rowSpan}`,
                      index === 0 ? 'bento-featured' : '',
                    ].join(' ')}
                    data-bento-slot
                    style={`animation-delay: ${index * 75}ms`}
                  >
                    <div class="bento-item-inner">
                      <img
                        src={image}
                        alt={`${project.data.title} image ${index + 1}`}
                        data-bento-img
                        loading={index === 0 ? 'eager' : 'lazy'}
                      />
                      {/* Overlay with index */}
                      <div class="bento-item-overlay">
                        <span class="bento-item-index">{String(index + 1).padStart(2, '0')}</span>
                        {index === 0 && (
                          <span class="bento-item-badge">Featured</span>
                        )}
                      </div>
                    </div>
                  </figure>
                );
              })}
            </div>

            <!-- Enhanced footline -->
            <div class="project-poster-footline" aria-hidden="true">
              <div class="footline-accent"></div>
            </div>
          </div>

          <!-- Project Overview Content -->
          <article class="project-overview-content">
            <h2 class="content-section-title">Project Overview</h2>
            <div class="prose project-prose prose-lg dark:prose-invert max-w-none prose-headings:font-heading prose-headings:uppercase prose-p:font-light prose-li:font-light">
              <Content />
            </div>
          </article>
        </div>
      </div>
    </div>
  </section>

  <LogoLoop />

  <!-- Next/Prev Navigation (Simplified to just Next for now) -->
  <SectionBackground client:visible showTopBorder={true} showBottomBorder={true} showBottomLine={true}>
    <section class="py-24 text-center">
      <div class="container mx-auto px-8">
        <h3 class="text-sm uppercase tracking-[0.3em] opacity-60 mb-6">Interested in working with us?</h3>
        <h2 class="text-4xl md:text-6xl font-bold uppercase mb-12 max-w-4xl mx-auto font-heading leading-tight">
          Let's Build Your<br/>Vision Together
        </h2>
        <a href="/contact" class="inline-block border border-primary/30 hover:bg-primary hover:text-white py-5 px-12 uppercase tracking-widest text-sm transition-all duration-300">
          Get in Touch
        </a>
      </div>
    </section>
  </SectionBackground>
</Layout>

<script is:inline>
  (() => {
    const bentoContainers = document.querySelectorAll('[data-project-bento]');
    if (!bentoContainers.length) return;

    bentoContainers.forEach((container) => {
      const rawImages = container.getAttribute('data-images');
      if (!rawImages) return;

      let images = [];
      try {
        images = JSON.parse(rawImages);
      } catch {
        return;
      }

      if (!Array.isArray(images) || images.length <= 6) return;

      const slots = Array.from(container.querySelectorAll('[data-bento-img]'));
      const prev = container.querySelector('[data-bento-prev]');
      const next = container.querySelector('[data-bento-next]');
      const currentPageEl = container.querySelector('[data-current-page]');
      const totalPagesEl = container.querySelector('[data-total-pages]');
      if (!slots.length || !prev || !next) return;

      const pageSize = slots.length;
      const totalPages = Math.ceil(images.length / pageSize);
      let currentPage = 0;

      // Update page indicator
      const updatePageIndicator = () => {
        if (currentPageEl) currentPageEl.textContent = String(currentPage + 1);
        if (totalPagesEl) totalPagesEl.textContent = String(totalPages);
      };

      const renderPage = () => {
        const start = currentPage * pageSize;
        const bentoItems = container.querySelectorAll('[data-bento-slot]');

        slots.forEach((img, slotIndex) => {
          const imageIndex = (start + slotIndex) % images.length;
          const src = images[imageIndex];
          if (typeof src !== 'string') return;

          // Animate transition
          img.style.opacity = '0';
          setTimeout(() => {
            img.src = src;
            img.alt = `Project supporting image ${imageIndex + 1}`;
            img.style.opacity = '1';
          }, 150);

          // Update index overlay
          const item = bentoItems[slotIndex];
          const indexOverlay = item?.querySelector('.bento-item-index');
          if (indexOverlay) {
            indexOverlay.textContent = String(imageIndex + 1).padStart(2, '0');
          }
        });

        updatePageIndicator();
      };

      prev.addEventListener('click', () => {
        currentPage = (currentPage - 1 + totalPages) % totalPages;
        renderPage();
      });

      next.addEventListener('click', () => {
        currentPage = (currentPage + 1) % totalPages;
        renderPage();
      });

      // Initialize
      updatePageIndicator();
      renderPage();

      // Add keyboard navigation
      container.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          currentPage = (currentPage - 1 + totalPages) % totalPages;
          renderPage();
        } else if (e.key === 'ArrowRight') {
          currentPage = (currentPage + 1) % totalPages;
          renderPage();
        }
      });
    });
  })();
</script>

<style>
  /* ============================================
     ENHANCED PROJECT DETAIL PAGE STYLES
     ============================================ */

  /* Noise texture for visual depth */
  .noise-texture {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  }

  /* Slide up animation */
  .animate-slide-up {
    animation: slideUp 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    opacity: 0;
    transform: translateY(50px);
  }

  @keyframes slideUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Fade in animation for bento items */
  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* ============================================
     HERO SECTION ENHANCEMENTS
     ============================================ */

  .project-hero-section {
    position: relative;
  }

  .project-hero-bg {
    transition: transform 0.1s ease-out;
    will-change: transform;
  }

  .project-hero-overlay {
    background:
      linear-gradient(180deg,
        hsl(0 0% 0% / 0.15) 0%,
        hsl(0 0% 0% / 0.35) 40%,
        hsl(0 0% 0% / 0.70) 75%,
        hsl(0 0% 0% / 0.88) 100%
      );
  }

  .project-hero-copy {
    display: inline-block;
    padding: clamp(0.5rem, 0.4rem + 1vw, 1.5rem);
  }

  /* Enhanced badges */
  .project-hero-chip {
    box-shadow:
      0 4px 12px -2px hsl(0 0% 0% / 0.4),
      0 0 0 1px hsl(0 0% 100% / 0.1) inset;
    backdrop-filter: blur(8px);
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .project-hero-chip:hover {
    transform: translateY(-2px);
    box-shadow:
      0 8px 20px -2px hsl(0 0% 0% / 0.5),
      0 0 0 1px hsl(0 0% 100% / 0.2) inset;
  }

  .category-badge {
    background: linear-gradient(135deg, hsl(var(--accent)), hsl(var(--accent) / 0.85));
  }

  .featured-badge {
    background: hsl(0 0% 100% / 0.08);
  }

  /* Enhanced title */
  .project-hero-title {
    font-size: clamp(2.5rem, 5vw, 5.5rem);
    letter-spacing: -0.02em;
    max-width: 28ch;
    background: linear-gradient(
      135deg,
      hsl(0 0% 100%) 0%,
      hsl(0 0% 98%) 30%,
      hsl(0 0% 92%) 70%,
      hsl(var(--accent) / 0.9) 100%
    );
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 4px 20px hsl(0 0% 0% / 0.5));
    display: flex;
    flex-direction: column;
    line-height: 0.95;
  }

  .project-hero-title > span {
    display: block;
    white-space: nowrap;
    animation: titleReveal 0.8s cubic-bezier(0.16, 1, 0.3, 1) backwards;
  }

  .project-hero-title > span:last-child {
    animation-delay: 0.15s;
  }

  @keyframes titleReveal {
    from {
      opacity: 0;
      transform: translateY(30px);
      filter: blur(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }
  }

  /* Enhanced location */
  .project-hero-location {
    letter-spacing: 0.03em;
    font-weight: 400;
  }

  /* ============================================
     PROJECT STATS SIDEBAR
     ============================================ */

  .project-stats-sidebar {
    position: relative;
    padding: clamp(1.2rem, 1rem + 1.2vw, 2rem);
    background: linear-gradient(170deg,
      hsl(var(--card) / 0.98),
      hsl(var(--card) / 0.92)
    );
    border: 1px solid hsl(var(--primary) / 0.12);
    box-shadow:
      0 20px 50px -30px hsl(var(--primary) / 0.5),
      0 0 0 1px hsl(var(--accent) / 0.05) inset;
  }

  .project-stats-sidebar::before {
    content: '';
    position: absolute;
    inset: 10px;
    border: 1px solid hsl(var(--accent) / 0.12);
    pointer-events: none;
  }

  .project-stats-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .project-stat-card {
    position: relative;
    padding: 1rem 1.1rem;
    background: hsl(var(--background) / 0.6);
    border: 1px solid hsl(var(--primary) / 0.08);
    border-left: 3px solid hsl(var(--accent) / 0.6);
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    animation: fadeInScale 0.5s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    overflow: hidden;
  }

  .project-stat-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, hsl(var(--accent) / 0.05), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .project-stat-card:hover {
    border-left-color: hsl(var(--accent));
    background: hsl(var(--background) / 0.8);
    transform: translateX(4px);
  }

  .project-stat-card:hover::before {
    opacity: 1;
  }

  .project-stat-card.stat-primary {
    border-left-color: hsl(var(--primary));
    background: linear-gradient(135deg, hsl(var(--primary) / 0.08), hsl(var(--background) / 0.6));
  }

  .project-stat-card.stat-secondary {
    border-left-color: hsl(142 76% 36%);
    background: linear-gradient(135deg, hsl(142 76% 36% / 0.08), hsl(var(--background) / 0.6));
  }

  .stat-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: hsl(var(--muted-foreground));
    margin-bottom: 0.35rem;
  }

  .stat-value {
    font-size: 0.95rem;
    font-weight: 600;
    color: hsl(var(--primary));
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    line-height: 1.4;
  }

  .stat-icon {
    width: 16px;
    height: 16px;
    opacity: 0.5;
    flex-shrink: 0;
  }

  .stat-meta {
    font-size: 0.7rem;
    color: hsl(var(--muted-foreground));
    margin-top: 0.25rem;
  }

  /* ============================================
     ENHANCED BENTO GRID
     ============================================ */

  .project-hero-bento-grid {
    display: grid;
    gap: clamp(0.5rem, 0.4rem + 0.5vw, 0.875rem);
    grid-template-columns: repeat(3, minmax(0, 1fr));
    grid-auto-rows: minmax(220px, 320px);
  }

  .project-bento-item {
    position: relative;
    overflow: hidden;
    border-radius: clamp(4px, 0.3vw, 8px);
    background: hsl(var(--card));
    box-shadow:
      0 4px 12px -4px hsl(var(--primary) / 0.3),
      0 0 0 1px hsl(var(--primary) / 0.06) inset;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    animation: fadeInScale 0.6s cubic-bezier(0.16, 1, 0.3, 1) backwards;
  }

  /* Column span variations */
  .project-bento-item.col-span-2 {
    grid-column: span 2;
  }

  .project-bento-item.row-span-2 {
    grid-row: span 2;
  }

  /* Featured item styling */
  .project-bento-item.bento-featured {
    border: 2px solid hsl(var(--accent) / 0.3);
    box-shadow:
      0 8px 24px -6px hsl(var(--primary) / 0.4),
      0 0 0 1px hsl(var(--accent) / 0.15) inset;
  }

  .bento-item-inner {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .project-bento-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition:
      transform 0.6s cubic-bezier(0.16, 1, 0.3, 1),
      filter 0.4s ease;
  }

  .project-bento-item:hover img {
    transform: scale(1.08);
    filter: saturate(1.08) brightness(1.02);
  }

  /* Bento item overlay */
  .bento-item-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      180deg,
      hsl(0 0% 0% / 0) 0%,
      hsl(0 0% 0% / 0.1) 50%,
      hsl(0 0% 0% / 0.6) 100%
    );
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 1rem;
  }

  .project-bento-item:hover .bento-item-overlay {
    opacity: 1;
  }

  .bento-item-index {
    font-size: 0.75rem;
    font-weight: 600;
    color: hsl(0 0% 100%);
    font-family: var(--font-heading);
    letter-spacing: 0.1em;
  }

  .bento-item-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.35rem 0.65rem;
    background: hsl(var(--accent) / 0.9);
    color: hsl(0 0% 100%);
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 600;
    border-radius: 2px;
    backdrop-filter: blur(4px);
  }

  /* ============================================
     ENHANCED POSTER SHELL
     ============================================ */

  .project-poster-shell {
    position: relative;
    padding: clamp(1rem, 0.8rem + 1vw, 1.8rem);
    background:
      linear-gradient(170deg, hsl(var(--background)), hsl(var(--card) / 0.95)),
      radial-gradient(ellipse at top left, hsl(var(--accent) / 0.03), transparent 50%);
    border: 1px solid hsl(var(--primary) / 0.1);
    box-shadow:
      0 25px 60px -30px hsl(var(--primary) / 0.5),
      0 0 0 1px hsl(var(--accent) / 0.05) inset;
    overflow: hidden;
    margin-bottom: 2rem;
  }

  .project-poster-shell::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg,
      transparent,
      hsl(var(--accent) / 0.4),
      transparent
    );
  }

  /* Enhanced frame with corner accents */
  .project-poster-frame {
    position: absolute;
    inset: 14px;
    border: 1px solid hsl(var(--accent) / 0.1);
    pointer-events: none;
  }

  .frame-corner {
    position: absolute;
    width: 8px;
    height: 8px;
    border-color: hsl(var(--accent) / 0.4);
    border-style: solid;
  }

  .frame-tl {
    top: -1px;
    left: -1px;
    border-width: 2px 0 0 2px;
  }

  .frame-tr {
    top: -1px;
    right: -1px;
    border-width: 2px 2px 0 0;
  }

  .frame-bl {
    bottom: -1px;
    left: -1px;
    border-width: 0 0 2px 2px;
  }

  .frame-br {
    bottom: -1px;
    right: -1px;
    border-width: 0 2px 2px 0;
  }

  /* Enhanced controls */
  .project-bento-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0 0.5rem;
  }

  .project-bento-control {
    width: 2.75rem;
    height: 2.75rem;
    border: 1px solid hsl(var(--primary) / 0.15);
    background: hsl(var(--card));
    color: hsl(var(--primary));
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
    border-radius: 4px;
  }

  .project-bento-control:hover {
    background: hsl(var(--primary));
    color: hsl(var(--primary-foreground));
    border-color: hsl(var(--primary));
    transform: scale(1.05);
  }

  .project-bento-control:active {
    transform: scale(0.98);
  }

  /* Page indicator */
  .bento-page-indicator {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.85rem;
    font-weight: 600;
    color: hsl(var(--muted-foreground));
    font-family: var(--font-heading);
  }

  .current-page {
    color: hsl(var(--primary));
    font-size: 1rem;
  }

  .page-separator {
    opacity: 0.5;
  }

  /* Enhanced footline */
  .project-poster-footline {
    position: relative;
    margin-top: clamp(1rem, 0.8rem + 0.8vw, 1.5rem);
    height: 2px;
    background: linear-gradient(90deg,
      transparent,
      hsl(var(--accent) / 0.5),
      hsl(var(--accent) / 0.2),
      hsl(var(--accent) / 0.5),
      transparent
    );
  }

  .footline-accent {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 4px;
    background: hsl(var(--accent));
    border-radius: 2px;
  }

  /* ============================================
     PROJECT OVERVIEW CONTENT
     ============================================ */

  .project-overview-title {
    position: relative;
    display: inline-block;
    text-transform: uppercase;
    letter-spacing: 0.16em;
    margin-bottom: 1.25rem;
    padding-bottom: 0.5rem;
    color: hsl(var(--primary));
    font-size: 0.85rem;
    font-weight: 700;
  }

  .project-overview-title::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: clamp(60px, 12vw, 100px);
    height: 2px;
    background: linear-gradient(90deg, hsl(var(--accent)), transparent);
  }

  .content-section-title {
    font-size: 1.5rem;
    letter-spacing: 0.08em;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    color: hsl(var(--primary));
    position: relative;
  }

  .content-section-title::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: 80px;
    height: 3px;
    background: hsl(var(--accent));
  }

  /* Prose styling */
  .project-prose :global(h2) {
    position: relative;
    display: inline-block;
    margin-top: 2.5em;
    margin-bottom: 0.75em;
    letter-spacing: 0.1em;
    color: hsl(var(--primary));
    padding-bottom: 0.4rem;
    font-size: 1.25rem;
  }

  .project-prose :global(h2:first-child) {
    margin-top: 0;
  }

  .project-prose :global(h2::after) {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: 60px;
    height: 2px;
    background: hsl(var(--accent));
    opacity: 0.8;
  }

  .project-prose :global(h1:first-child),
  .project-prose :global(h1:first-child + p) {
    display: none;
  }

  .project-prose :global(p) {
    color: hsl(var(--foreground) / 0.85);
    line-height: 1.8;
    margin-bottom: 1.25rem;
  }

  .project-prose :global(ul) {
    margin-top: 1.25rem;
    margin-bottom: 1.75rem;
    display: grid;
    gap: 0.75rem;
  }

  .project-prose :global(li) {
    padding-left: 0.5rem;
    position: relative;
  }

  .project-prose :global(li::marker) {
    color: hsl(var(--accent));
    font-size: 0.9em;
  }

  /* ============================================
     LAYOUT & RESPONSIVE
     ============================================ */

  .project-details-section {
    position: relative;
    background:
      radial-gradient(1400px 600px at -10% -20%, hsl(var(--accent) / 0.06), transparent 50%),
      linear-gradient(180deg, hsl(var(--background)) 0%, hsl(var(--background) / 0.98) 100%);
  }

  .project-overview-bento-layout {
    display: grid;
    grid-template-columns: minmax(260px, 320px) minmax(0, 1fr);
    gap: 1.5rem;
    align-items: start;
  }

  .project-main-content {
    display: flex;
    flex-direction: column;
  }

  .project-overview-content {
    position: relative;
    padding: clamp(1.5rem, 1.2rem + 1.2vw, 2.5rem);
    background: linear-gradient(170deg, hsl(var(--card) / 0.95), hsl(var(--card) / 0.9));
    border: 1px solid hsl(var(--primary) / 0.1);
    box-shadow: 0 15px 40px -25px hsl(var(--primary) / 0.3);
  }

  /* Tablet styles */
  @media (max-width: 1023px) {
    .project-hero-copy {
      max-width: min(94vw, 46rem);
    }

    .project-hero-bento-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      grid-auto-rows: minmax(200px, 280px);
    }

    .project-bento-item.bento-featured {
      grid-column: span 2;
      grid-row: span 1;
    }

    .project-poster-frame {
      inset: 10px;
    }

    .project-overview-bento-layout {
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }

    .project-stats-sidebar {
      order: 2;
    }

    .project-main-content {
      order: 1;
    }

    .project-stats-list {
      flex-direction: row;
      flex-wrap: wrap;
    }

    .project-stat-card {
      flex: 1 1 calc(50% - 0.5rem);
      min-width: 150px;
    }
  }

  /* Mobile styles */
  @media (max-width: 640px) {
    .project-hero-section {
      min-height: 600px;
    }

    .project-hero-bento-grid {
      grid-template-columns: 1fr;
      grid-auto-rows: minmax(200px, 250px);
    }

    .project-bento-item.bento-featured {
      grid-column: span 1;
      grid-row: span 1;
    }

    .project-bento-item.col-span-2 {
      grid-column: span 1;
    }

    .project-poster-shell {
      padding: 1rem;
    }

    .project-poster-frame {
      inset: 6px;
    }

    .project-bento-controls {
      padding: 0;
    }

    .project-bento-control {
      width: 2.25rem;
      height: 2.25rem;
    }

    .project-overview-content {
      padding: 1.25rem;
    }

    .project-stats-list {
      flex-direction: column;
    }

    .project-stat-card {
      flex: 1 1 100%;
    }

    .bento-item-badge {
      top: 0.75rem;
      right: 0.75rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.6rem;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .animate-slide-up,
    .project-bento-item,
    .project-stat-card,
    .project-hero-title > span {
      animation: none !important;
    }

    .project-bento-item img,
    .project-bento-item:hover img,
    .project-hero-chip:hover,
    .project-stat-card:hover {
      transform: none !important;
      transition: none !important;
    }
  }
</style>
