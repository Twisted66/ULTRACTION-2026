---
// VideoPlayer.astro - Reusable video player component for ULTRACTION website
// Supports autoplay, muted, loop, and poster fallback images

interface Props {
  src: string;
  poster?: string;
  autoplay?: boolean;
  muted?: boolean;
  loop?: boolean;
  controls?: boolean;
  class?: string;
  fallbackImage?: string;
}

const {
  src,
  poster,
  autoplay = true,
  muted = true,
  loop = true,
  controls = false,
  class: className = "",
  fallbackImage
} = Astro.props;

// Build video attributes dynamically
const videoAttrs = {
  ...(autoplay && { autoplay: true }),
  ...(muted && { muted: true }),
  ...(loop && { loop: true }),
  ...(controls && { controls: true }),
  playsinline: true,
  class: "w-full h-full object-cover",
  ...(poster && { poster }),
};
---

<div class={`video-player relative overflow-hidden ${className}`}>
  <video {...videoAttrs}>
    <source src={src} type="video/mp4" />
    <!-- Fallback image if video doesn't load -->
    {fallbackImage && (
      <img src={fallbackImage} alt="Video fallback image" class="w-full h-full object-cover" />
    )}
  </video>
</div>

<style>
  /* Ensure video maintains aspect ratio and fills container */
  .video-player {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .video-player video {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Ensure video works on iOS */
  .video-player video::-webkit-media-controls {
    opacity: 1;
  }

  /* Smooth loading */
  .video-player video {
    background-color: hsl(var(--color-bg));
  }
</style>
