---
/**
 * MagneticButton - Interactive button with magnetic cursor effect
 * Features:
 * - Attracts towards cursor when nearby
 * - Smooth magnetic pull with configurable strength
 * - Subtle scale on hover
 * - Ripple effect on click
 * - Works with any button content
 */

interface Props {
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  magnetic?: boolean; // Enable magnetic effect
  strength?: number; // Magnetic pull strength (0-1)
  ripple?: boolean; // Enable click ripple
  href?: string; // If provided, renders as link
  type?: 'button' | 'submit' | 'reset';
  class?: string; // Additional classes
}

const {
  variant = 'primary',
  size = 'md',
  magnetic = true,
  strength = 0.5,
  ripple = true,
  href,
  type = 'button',
  class: additionalClass = '',
} = Astro.props;

const id = `magnetic-${Math.random().toString(36).slice(2, 11)}`;

// Size classes
const sizeClasses = {
  sm: 'px-4 py-2 text-xs min-h-[36px]',
  md: 'px-8 py-4 text-sm min-h-[48px]',
  lg: 'px-12 py-5 text-base min-h-[56px]',
};

// Variant classes
const variantClasses = {
  primary: 'bg-primary text-white hover:bg-primary/90',
  secondary: 'bg-accent text-white hover:bg-accent/90',
  outline: 'border-2 border-primary text-primary hover:bg-primary hover:text-white',
  ghost: 'text-primary hover:bg-primary/5',
};
---

{
  href ? (
    <a
      href={href}
      id={id}
      data-magnetic={magnetic}
      data-strength={strength}
      data-ripple={ripple}
      class={`magnetic-btn inline-flex items-center justify-center font-medium uppercase tracking-widest transition-all duration-300 ${variantClasses[variant]} ${sizeClasses[size]} ${additionalClass}`}
    >
      <slot />
    </a>
  ) : (
    <button
      id={id}
      type={type}
      data-magnetic={magnetic}
      data-strength={strength}
      data-ripple={ripple}
      class={`magnetic-btn inline-flex items-center justify-center font-medium uppercase tracking-widest transition-all duration-300 ${variantClasses[variant]} ${sizeClasses[size]} ${additionalClass}`}
    >
      <slot />
    </button>
  )
}

<style>
  /* Magnetic Button Styles */
  .magnetic-btn {
    position: relative;
    overflow: hidden;
    border-radius: var(--radius, 0px);
    transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1),
                box-shadow 0.3s ease,
                background-color 0.3s ease,
                color 0.3s ease;
    cursor: pointer;
  }

  .magnetic-btn:hover {
    transform: translate3d(0, 0, 0);
  }

  /* Ripple Effect */
  .ripple {
    position: absolute;
    border-radius: 50%;
    background: currentColor;
    opacity: 0.3;
    transform: scale(0);
    animation: ripple-animation 0.6s ease-out;
    pointer-events: none;
  }

  @keyframes ripple-animation {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }

  /* Focus styles for accessibility */
  .magnetic-btn:focus-visible {
    outline: 2px solid hsl(var(--color-accent));
    outline-offset: 2px;
  }

  /* Disabled state */
  .magnetic-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }
</style>

<script is:inline define:vars={{ id }}>
  // Magnetic Button Effect
  class MagneticButton {
    constructor(button) {
      this.button = button;
      this.strength = parseFloat(button.dataset.strength) || 0.5;
      this.ripple = button.dataset.ripple === 'true';
      this.rect = null;
      this.bound = false;
      this.init();
    }

    init() {
      if (this.button.dataset.magnetic !== 'true') return;

      // Track mouse position
      this.button.addEventListener('mousemove', (e) => this.onMouseMove(e));
      this.button.addEventListener('mouseleave', () => this.onMouseLeave());

      // Setup ripple if enabled
      if (this.ripple) {
        this.button.addEventListener('click', (e) => this.createRipple(e));
      }
    }

    onMouseMove(e) {
      if (!this.bound) {
        this.rect = this.button.getBoundingClientRect();
        this.bound = true;
      }

      const x = e.clientX - this.rect.left - this.rect.width / 2;
      const y = e.clientY - this.rect.top - this.rect.height / 2;

      this.button.style.transform = `translate3d(${x * this.strength}px, ${y * this.strength}px, 0)`;
    }

    onMouseLeave() {
      this.button.style.transform = '';
      this.bound = false;
    }

    createRipple(e) {
      const ripple = document.createElement('span');
      ripple.classList.add('ripple');

      const rect = this.button.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = e.clientX - rect.left - size / 2;
      const y = e.clientY - rect.top - size / 2;

      ripple.style.width = ripple.style.height = `${size}px`;
      ripple.style.left = `${x}px`;
      ripple.style.top = `${y}px`;

      this.button.appendChild(ripple);

      ripple.addEventListener('animationend', () => ripple.remove());
    }
  }

  // Initialize magnetic buttons
  document.querySelectorAll('#' + id + '.magnetic-btn').forEach(btn => {
    new MagneticButton(btn);
  });
</script>
